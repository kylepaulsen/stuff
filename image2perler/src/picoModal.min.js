!function(e,t){"use strict";"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():e.picoModal=t()}(this,function(){"use strict";function e(e){return"object"==typeof Node?e instanceof Node:e&&"object"==typeof e&&"number"==typeof e.nodeType}function t(e){return"string"==typeof e}function n(){var e=[];return{watch:e.push.bind(e),trigger:function(t){for(var n=!0,o={preventDefault:function(){n=!1}},i=0;i<e.length;i++)e[i](t,o);return n}}}function o(e){return"none"===window.getComputedStyle(e).display}function i(e){this.elem=e}function r(e,t){return i.make(e("parent")).clazz("pico-overlay").clazz(e("overlayClass","")).stylize({display:"none",position:"fixed",top:"0px",left:"0px",height:"100%",width:"100%",zIndex:1e4}).stylize(e("overlayStyles",{opacity:.5,background:"#000"})).onClick(function(){e("overlayClose",!0)&&t()})}function l(e,t){var n=e("width","auto");"number"==typeof n&&(n=""+n+"px");var o=e("modalId","pico-"+f++),r=i.make(e("parent")).clazz("pico-content").clazz(e("modalClass","")).stylize({display:"none",position:"fixed",zIndex:10001,left:"50%",top:"38.1966%",maxHeight:"90%",boxSizing:"border-box",width:n,"-ms-transform":"translate(-50%,-38.1966%)","-moz-transform":"translate(-50%,-38.1966%)","-webkit-transform":"translate(-50%,-38.1966%)","-o-transform":"translate(-50%,-38.1966%)",transform:"translate(-50%,-38.1966%)"}).stylize(e("modalStyles",{overflow:"auto",backgroundColor:"white",padding:"20px",borderRadius:"5px"})).html(e("content")).attr("id",o).attr("role","dialog").attr("aria-labelledby",e("ariaLabelledBy")).attr("aria-describedby",e("ariaDescribedBy",o)).onClick(function(e){var n=new i(e.target).anyAncestor(function(e){return/\bpico-close\b/.test(e.elem.className)});n&&t()});return r}function a(e,t){return t("closeButton",!0)?e.child("button").html(t("closeHtml","&#xD7;")).clazz("pico-close").clazz(t("closeClass","")).stylize(t("closeStyles",{borderRadius:"2px",border:0,padding:0,cursor:"pointer",height:"15px",width:"15px",position:"absolute",top:"5px",right:"5px",fontSize:"16px",textAlign:"center",lineHeight:"15px",background:"#CCC"})).attr("aria-label",t("close-label","Close")):void 0}function c(e){return function(){return e().elem}}function s(e,t){function n(e,t){var n=e.msMatchesSelector||e.webkitMatchesSelector||e.matches;return n.call(e,t)}function i(e){return o(e)||n(e,":disabled")||e.hasAttribute("contenteditable")?!1:e.hasAttribute("tabindex")||n(e,"input,select,textarea,button,a[href],area[href],iframe")}function r(e){for(var t=e.getElementsByTagName("*"),n=0;n<t.length;n++)if(i(t[n]))return t[n]}function l(e){for(var t=e.getElementsByTagName("*"),n=t.length;n--;)if(i(t[n]))return t[n]}var a;e.beforeShow(function(){a=document.activeElement}),e.afterShow(function(){if(t()){var n=r(e.modalElem());n&&n.focus()}}),e.afterClose(function(){t()&&a&&a.focus(),a=null}),h.watch(function(n){if(t()&&e.isVisible()){var o=r(e.modalElem()),i=l(e.modalElem()),a=n.shiftKey?o:i;a===document.activeElement&&((n.shiftKey?i:o).focus(),n.preventDefault())}})}function u(e,t){var n,o=new i(document.body);e.beforeShow(function(){n=o.elem.style.overflow,t()&&o.stylize({overflow:"hidden"})}),e.afterClose(function(){o.stylize({overflow:n})})}i.make=function(e,t){"string"==typeof e&&(e=document.querySelector(e));var n=document.createElement(t||"div");return(e||document.body).appendChild(n),new i(n)},i.prototype={child:function(e){return i.make(this.elem,e)},stylize:function(e){e=e||{},"undefined"!=typeof e.opacity&&(e.filter="alpha(opacity="+100*e.opacity+")");for(var t in e)e.hasOwnProperty(t)&&(this.elem.style[t]=e[t]);return this},clazz:function(e){return this.elem.className+=" "+e,this},html:function(t){return e(t)?this.elem.appendChild(t):this.elem.innerHTML=t,this},onClick:function(e){return this.elem.addEventListener("click",e),this},destroy:function(){this.elem.parentNode.removeChild(this.elem)},hide:function(){this.elem.style.display="none"},show:function(){this.elem.style.display="block"},attr:function(e,t){return void 0!==t&&this.elem.setAttribute(e,t),this},anyAncestor:function(e){for(var t=this.elem;t;){if(e(new i(t)))return!0;t=t.parentNode}return!1},isVisible:function(){return!o(this.elem)}};var f=1,d=n(),h=n();return document.documentElement.addEventListener("keydown",function(e){var t=e.which||e.keyCode;27===t?d.trigger():9===t&&h.trigger(e)}),function(o){function i(e,t){var n=o[e];return"function"==typeof n&&(n=n(t)),void 0===n?t:n}function f(){k().hide(),C().hide(),x.trigger(y)}function h(){z.trigger(y)&&f()}function m(e){return function(){return e.apply(this,arguments),y}}function p(e){if(!b){var t=l(i,h);b={modal:t,overlay:r(i,h),close:a(t,i)},v.trigger(y)}return b[e]}(t(o)||e(o))&&(o={content:o});var y,b,v=n(),w=n(),g=n(),z=n(),x=n(),C=p.bind(window,"modal"),k=p.bind(window,"overlay"),E=p.bind(window,"close");return y={modalElem:c(C),closeElem:c(E),overlayElem:c(k),buildDom:m(p),isVisible:function(){return!!(b&&C&&C().isVisible())},show:function(){return w.trigger(y)&&(k().show(),E(),C().show(),g.trigger(y)),this},close:m(h),forceClose:m(f),destroy:function(){C().destroy(),k().destroy(),k=C=E=void 0},options:function(e){Object.keys(e).map(function(t){o[t]=e[t]})},afterCreate:m(v.watch),beforeShow:m(w.watch),afterShow:m(g.watch),beforeClose:m(z.watch),afterClose:m(x.watch)},s(y,i.bind(null,"focus",!0)),u(y,i.bind(null,"bodyOverflow",!0)),d.watch(function(){i("escCloses",!0)&&y.isVisible()&&y.close()}),y}});
